<html>
<head>
    <title>Bagpack</title>
    <link href="style.css" rel="stylesheet" />
    <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script>
        /* Déclaration des variables  */
        var geocoder;
        var map;
        var infowindow = new google.maps.InfoWindow();
        var marker;

        /* Fonction d'initialisation de la map appelée au chargement de la page  */
        function initialize() {
            geocoder = new google.maps.Geocoder();
            var latlng = new google.maps.LatLng(48.8566667, 2.3509871);
            var myOptions = {
                zoom: 3,
                center: latlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            }
            map = new google.maps.Map(document.getElementById("map"), myOptions);
        }

        /* You will get a position from an address */
        function geocodeAddress(address) {
            geocoder.geocode( { 'address': address }, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    var coords = results[0].geometry.location
                    map.setCenter(coords);
                    var marker = new google.maps.Marker({
                        map: map,
                        position: coords
                    });
                } else {
                    alert("GeoCoding failed...: " + status);
                }
            });
        }

        window.onload = function() {
            initialize();
            var txtFile = new XMLHttpRequest();
            txtFile.open("GET", "locations.txt", true);
            txtFile.onreadystatechange = function() {
                if ( (txtFile.readyState === 4) && (txtFile.status === 200) ) {
                    allText = txtFile.responseText; 
                    lines = txtFile.responseText.split("\n");
                    for (idx in lines){
                        if (lines[idx] == '') { continue; }
                        geocodeAddress(lines[idx]);
                    }
                }
            }
            txtFile.send(null);
        }

    </script>
</head>
<body>

    <div id="map">
    </div>
<a href="http://github.com/maximeh/bagpack"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/4c7dc970b89fd04b81c8e221ba88ff99a06c6b61/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub"></a>

</body>
</html>
